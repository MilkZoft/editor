<!DOCTYPE html>
<html>
	<head>
		<style>
		  	#editor {
		  		background: #EEE;
		  		border: 1px dotted #DDD;
		  		font-size: 0.8em;
		  		font-family: Arial, Verdana;
		  		width: 600px;
		  		height: 350px;
		  		margin: 0 auto;		  		
		  	}

		  	.editor-btns {
		  		width: 600px;	
		  		margin-bottom: 10px;	  		
		  	}

		  	.editor-btns button {
		  		margin: 5px;
		  	}
		</style>

		<link rel="stylesheet" href="css/bootstrap.css" type="text/css" />
		
		<script src="http://code.jquery.com/jquery-latest.js"></script>
	</head>

	<body>

		<p><textarea id="editor"></textarea></p>

		<script>
			$.fn.myTextEditor = function(options) {		    
			    var settings = $.extend({
			        width : "600px",
			        height : "350px"
			    }, options);

			    return this.each(function() {
			       	var $this = $(this).hide();
			
				   	var containerDiv = $("<div/>", {
				       	css : {
				           	width  : settings.width,
				           	height : settings.height,
				           	border : "1px solid #ccc",
				           	margin : "0 auto",
				           	"font-family" : "Arial, Verdana"
				       	}
				   	});

				   	$this.after(containerDiv); 

				   	var editor = $("<iframe/>",{
				       	frameborder : "0",
				       	css : {
				           	width : settings.width,
				           	height : settings.height
				       	}
				   	}).appendTo(containerDiv).get(0);
				   
				   	editor.contentWindow.document.open();
				   	editor.contentWindow.document.close();
				   	editor.contentWindow.document.designMode="on";

				   	var buttonPane = $("<div/>",{
					    "class" : "editor-btns",
					    css : {
					        width : settings.width,
					        height : "20px"
					    }
					}).prependTo(containerDiv);
					
					var btnBold = $("<button/>",{
						class : "bold btn btn-inverse",					    
					    text  : "B",
					    data  : {
					        commandName : "bold"
					    },
					    click : execCommand 
					}).appendTo(buttonPane);

					var btnItalic = $("<button/>",{
						class   : "italic btn btn-inverse",					    
					    text : "I",
					    data : {
					        commandName : "italic"
					    },
					    click : execCommand 
					}).appendTo(buttonPane);

					var btnUnderline = $("<button/>",{
						class   : "underline btn btn-inverse",					    
					    text : "U",
					    data : {
					        commandName : "underline"
					    },
					    click : execCommand 
					}).appendTo(buttonPane);

					function execCommand(e) {
					    $(this).toggleClass("selected");
					    
					    var contentWindow = editor.contentWindow;
					    console.log(contentWindow);
					    contentWindow.focus();
					    contentWindow.document.execCommand($(this).data("commandName"), false, "");
					    contentWindow.focus();

					    return false;
					}
			    });
			} 			

			$(function(){
			    $("textarea").myTextEditor();
			});

			$(document).on("keydown", "#editor", function(e){ 
  				var keyCode = e.keyCode || e.which;   				

			    if(keyCode == 9) {
			    	var html = $('#editor').val();
			    	var myValue = "\t";
			    	var startPos = $('#editor')[0].selectionStart;
			    	var endPos = $('#editor')[0].selectionEnd;
			    	var scrollTop = $('#editor')[0].scrollTop;			    				    			    	

			    	var content = html.substring(0, startPos) + myValue + html.substring(endPos, html.length);

			    	$('#editor').focus();

			    	$('#editor')[0].selectionStart = startPos + myValue.length;
			    	$('#editor')[0].selectionEnd = startPos + myValue.length;
			    	$('#editor')[0].scrollTop = scrollTop;

			    	$('#editor').val(content);

			    	e.preventDefault();
			    }			
			});			
		</script>
	 
	</body>
</html>